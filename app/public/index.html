<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>gh-game-of-life — Terminal Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      height: 100vh;
      background-color: #0d1117;
      font-family: monospace;
      color: #c9d1d9;
      overflow: hidden;
    }

    /* Grid background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(0deg, transparent 24%, rgba(100,100,100,0.2) 25%, rgba(100,100,100,0.2) 26%, transparent 27%, transparent 74%, rgba(100,100,100,0.2) 75%, rgba(100,100,100,0.2) 76%, transparent 77%),
        linear-gradient(90deg, transparent 24%, rgba(100,100,100,0.2) 25%, rgba(100,100,100,0.2) 26%, transparent 27%, transparent 74%, rgba(100,100,100,0.2) 75%, rgba(100,100,100,0.2) 76%, transparent 77%);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    /* GitHub icon */
    .github-link {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 10;
    }

    .github-link svg {
      width: 26px;
      height: 26px;
      fill: #58a6ff;
      transition: transform 0.2s, fill 0.2s;
    }

    .github-link:hover svg {
      transform: scale(1.1);
      fill: #79c0ff;
    }

    /* Layout */
    .page {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 3rem;
    }

    /* Header */
    .header {
      margin-top: 5rem;
      margin-bottom: 4rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2.2rem;
      letter-spacing: 1px;
      background: linear-gradient(135deg, #58a6ff, #79c0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }

    .header p {
      font-size: 0.9rem;
      color: #8b949e;
      max-width: 600px;
    }

    /* Terminal */
    .terminal {
      width: 820px;
      max-width: 92%;
      height: 480px;
      background: rgba(13, 17, 23, 0.88);
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 1rem;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(0,0,0,0.5);
    }

    .line { margin-bottom: 0.5rem; white-space: pre-wrap; }
    .prompt { color: #58a6ff; }
    .command { color: #79c0ff; }
    .system { color: #8b949e; }
    .error { color: #f85149; }
    .success { color: #3fb950; }

    .input-line {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: #c9d1d9;
      font-family: monospace;
      font-size: 1rem;
    }

    img {
      max-width: 100%;
      border: 1px solid #30363d;
      margin-top: 0.5rem;
      border-radius: 4px;
      image-rendering: pixelated;
    }

    button {
      margin-top: 0.5rem;
      background: none;
      border: none;
      color: #58a6ff;
      cursor: pointer;
      font-family: monospace;
    }

    button:hover { text-decoration: underline; }

    /* Rotating note */
    .note {
      margin-top: 0.75rem;
      font-size: 0.8rem;
      color: #8b949e;
      text-align: center;
      min-height: 1.2em;
    }

    .note a {
      color: #58a6ff;
      text-decoration: none;
    }

    .note a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <!-- GitHub -->
  <a class="github-link" href="https://github.com/apoupon/gh-game-of-life" target="_blank" rel="noopener">
    <svg viewBox="0 0 16 16">
      <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
    </svg>
  </a>

  <div class="page">
    <div class="header">
      <h1>gh-game-of-life</h1>
      <p>Visualizes GitHub contribution graphs as Conway's Game of Life</p>
    </div>

    <div class="terminal">
      <div id="terminal"></div>

      <div class="input-line">
        <span class="prompt">&gt;</span>
        <input id="input" autocomplete="off" />
      </div>
    </div>

    <div id="note" class="note"></div>
  </div>

  <script>
    const terminal = document.getElementById('terminal');
    const input = document.getElementById('input');
    const note = document.getElementById('note');
    const history = [];   // stores entered commands
    let historyIndex = -1; // pointer for navigating history

    const FRAMES = 100;
    const STRATEGY = 'loop';

    function scrollTerminalToBottom() {
      terminal.scrollTop = terminal.scrollHeight;
      input.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    function print(text, cls = '') {
      const div = document.createElement('div');
      div.className = `line ${cls}`;
      div.textContent = text;
      terminal.appendChild(div);
      scrollTerminalToBottom();
    }

    function printNode(node) {
      terminal.appendChild(node);

      if (node.tagName === 'IMG') {
        // Wait for the image to fully load
        node.onload = () => scrollTerminalToBottom();
      } else {
        scrollTerminalToBottom();
      }
    }

    function banner() {
      print('gh-game-of-life — terminal interface', 'success');
      print('Type /help to list commands.', 'system');
      print('');
    }

    function disableInput() {
      input.disabled = true;
      input.style.color = 'transparent';      // hide text
      input.style.caretColor = 'transparent'; // hide cursor
      document.querySelector('.input-line .prompt').style.visibility = 'hidden';
    }

    function enableInput() {
      input.disabled = false;
      input.style.color = '#c9d1d9';         // restore text color
      input.style.caretColor = '#c9d1d9';    // restore cursor
      document.querySelector('.input-line .prompt').style.visibility = 'visible';
      input.focus();                          // give focus back
    }

    // Make terminal clicks focus the input
    document.querySelector('.terminal').addEventListener('click', () => {
      input.focus();
    });

    async function generate(username) {

      disableInput(); // block terminal during generation

      print(`Generating GIF for "${username}"...`, 'system');

      try {
        const params = new URLSearchParams({
          username,
          frames: FRAMES,
          strategy: STRATEGY
        });

        const LOCAL_HOSTNAMES = ["localhost", "127.0.0.1", "::1"];

        const API_BASE = LOCAL_HOSTNAMES.includes(window.location.hostname)
          ? "http://127.0.0.1:8000"
          : "";

        const res = await fetch(`${API_BASE}/api/generate?${params}`);
        if (!res.ok) throw new Error(`All cells died unexpectedly (HTTP ${res.status})`);

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        print('Generation complete.', 'success');

        const img = document.createElement('img');
        img.src = url;
        img.style.display = 'block';
        img.style.margin = '0 auto';
        printNode(img);

        const btn = document.createElement('button');
        btn.textContent = '⬇ Download GIF';
        btn.style.display = 'block';
        btn.style.margin = '0 auto';
        btn.onclick = () => {
          const a = document.createElement('a');
          a.href = url;
          a.download = 'game-of-life.gif';
          a.click();
        };
        printNode(btn);

      } catch (err) {
        print(err.message, 'error');
      } finally {
        enableInput();  // unblock terminal
      }
    }

    function showContext() {
      print('About this project:', 'success');
      print(
`This demo transforms GitHub contribution grids into evolving cellular
automata simulations.

The Game of Life is a cellular automaton devised by the British mathematician
John Horton Conway in 1970. It is a zero-player game meaning that its evolution
is determined by its initial state, requiring no further input. Despite being
governed by just three simple rules, it can give rise to incredibly complex
behaviors and patterns. The Game of Life is a perfect example of how simple
rules can generate unexpected complexity.

An interesting variation of the Life rules is to use several distinct living
state, with each behaving according to Life rules, but, in addition, carrying
independent color information. The color of each newly-born bit is determined by
the color of its parents. Resulting patterns have exactly the same life/death
behavior as in normal Life, but the colors of resulting bits provides interesting
additional complexity.

This project uses the Quad-Life variant, which employs four symmetrical colors,
creating vibrant, evolving patterns while maintaining the familiar Life behavior.`
      );
    }

    function showHelp() {
      print('Commands:', 'success');
      print('/generate <username>             Generate a GIF from `username` contribution graph');
      print('/about                           About the project');
      print('/clear                           Clear the terminal');
      print('/help                            Show this help');
    }

    const COMMANDS = ['/generate', '/clear', '/help', '/about'];

    input.addEventListener('keydown', (e) => {
    const value = input.value;

    // Ctrl+C / Cmd+C
    if (e.ctrlKey && e.key.toLowerCase() === 'c') {
      e.preventDefault();               // prevent text selection
      const currentText = input.value;  // capture current input
      if (currentText) print(`> ${currentText}`, 'command'); // print what user typed
      print('^C', 'error');             // print ^C on a new line
      input.value = '';                 // clear input
      scrollTerminalToBottom();         // scroll
      return;
    }

    // Tab autocomplete
    if (e.key === 'Tab') {
      e.preventDefault();
      if (!value.startsWith('/')) return;

      const matches = COMMANDS.filter(cmd => cmd.startsWith(value));
      if (matches.length === 1) input.value = matches[0] + ' ';
      else if (matches.length > 1) print(matches.join('   '), 'system');
      return;
    }

    // Arrow up/down for history
    if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (history.length === 0) return;
      if (historyIndex === -1) historyIndex = history.length; // start at the end
      historyIndex = Math.max(0, historyIndex - 1);
      input.value = history[historyIndex];
      return;
    }

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (history.length === 0) return;
      if (historyIndex === -1) {
        input.value = ''; // nothing to show
        return;
      }

      historyIndex++;

      if (historyIndex >= history.length) {
        input.value = '';      // ✅ blank if no more history
        historyIndex = -1;     // reset index
      } else {
        input.value = history[historyIndex];
      }
      return;
    }

    // Enter key
    if (e.key !== 'Enter') return;

    const trimmed = value.trim();
    if (!trimmed) {
      print('');        // prints a new empty line
      input.value = ''; // clear input
      scrollTerminalToBottom();
      return;
    }

    print(`> ${trimmed}`, 'command');
    input.value = '';
    scrollTerminalToBottom();

    // Add command to history
    history.push(trimmed);
    historyIndex = -1; // reset index after entering

    const [cmd, ...args] = trimmed.split(/\s+/);
    const arg = args.join(' ');

    if (cmd === '/generate') {
      if (!arg) print('Usage: /generate <username>', 'error');
      else generate(arg);
    } else if (cmd === '/about') {
      showContext();
    } else if (cmd === '/help') {
      showHelp();
    } else if (cmd === '/clear') {
      terminal.innerHTML = '';  // Clear everything
      banner();                  // Reprint the banner
    } else {
      print('Unknown command. Type /help.', 'error');
    }
  });



    // Rotating note
    const notes = [
      'Enjoying the repo? <a href="https://github.com/apoupon/gh-game-of-life" target="_blank">⭐ Star it</a>',
      'Use the <a href="https://github.com/apoupon/gh-game-of-life#readme" target="_blank">library</a> for full CLI functionality'
    ];

    let noteIndex = 0;
    function rotateNote() {
      note.innerHTML = notes[noteIndex];
      noteIndex = (noteIndex + 1) % notes.length;
    }

    setInterval(rotateNote, 4000);
    rotateNote();

    banner();
  </script>
</body>
</html>
